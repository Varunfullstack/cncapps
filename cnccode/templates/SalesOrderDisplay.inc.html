<!-- Template: SalesOrderDisplay.inc.html -->
<script src="CommonJS.js"
></script>

<script type="text/javascript">

    function customerNotePopup() {
        window.open(
            '{urlCustomerNote}',
            'item',
            'scrollbars=yes,resizable=yes,width=660,height=560,copyhistory=no, menubar=0'
        );

    }

    function serviceRequestPopup() {
        window.open(
            '{urlServiceRequest}',
            'item',
            'scrollbars=yes,resizable=yes,width=900,height=800,copyhistory=no, menubar=0'
        );

    }

    function checkFunctionKey(field) {

        if (event.keyCode == 120) {			// F9 - edit
            switch (field.id) {
                case "itemDescription":
                    if (document.getElementById("itemID").value != "0") {
                        window.open(
                            '{urlItemEdit}&itemID=' +
                            escape(document.getElementById("itemID").value) +
                            '&parentIDField=itemID' +
                            '&parentDescField=itemDescription',
                            'item',
                            'scrollbars=yes,resizable=yes,width=610,height=560,copyhistory=no, menubar=0'
                        );
                    }
                    break;
                case "supplierName":
                    if (document.getElementById("supplierID").value != "0") {
                        window.open(
                            '{urlSupplierEdit}&supplierID=' +
                            escape(document.getElementById("supplierID").value) +
                            '&parentIDField=supplierID' +
                            '&parentDescField=supplierName',
                            'supplier',
                            'scrollbars=yes,resizable=yes,height=550,width=500,copyhistory=no, menubar=0'
                        );
                    }
                    break;

                case "updateSupplierName":
                    if (document.getElementById("updateSupplierID").value != "0") {
                        window.open(
                            '{urlSupplierEdit}&supplierID=' +
                            escape(document.getElementById("updateSupplierID").value) +
                            '&parentIDField=updateSupplierID' +
                            '&parentDescField=updateSupplierName',
                            'supplier',
                            'scrollbars=yes,resizable=yes,height=550,width=500,copyhistory=no, menubar=0'
                        );
                    }
                    break;
                case "invSiteDesc":
                    if (document.getElementById("invSiteNo").value != "") {
                        window.open(
                            '{urlSiteEdit}&customerID={customerID}' +
                            '&siteNo=' + escape(document.getElementById("invSiteNo").value) +
                            '&parentIDField=invSiteNo' +
                            '&parentDescField=invSiteDesc',
                            'address', 'scrollbars=yes,resizable=yes,height=550,width=500,copyhistory=no, menubar=0'
                        );
                    }
                    break;
                case "delSiteDesc":
                    if (document.getElementById("delSiteNo").value != "") {
                        window.open(
                            '{urlSiteEdit}&customerID={customerID}' +
                            '&siteNo=' + escape(document.getElementById("delSiteNo").value) +
                            '&parentIDField=delSiteNo' +
                            '&parentDescField=delSiteDesc',
                            'address', 'scrollbars=yes,resizable=yes,height=550,width=500,copyhistory=no, menubar=0');
                    }
                    break;
                case "invContactName":
                    if (document.getElementById("invContactID").value != "") {
                        window.open(
                            '{urlContactEdit}' +
                            '&contactID=' + escape(document.getElementById("invContactID").value) +
                            '&parentIDField=invContactID' +
                            '&parentDescField=invContactName',
                            'address', 'scrollbars=yes,resizable=yes,height=550,width=500,copyhistory=no, menubar=0');
                    }
                    break;
                case "delContactName":
                    if (document.getElementById("delContactID").value != "") {
                        window.open(
                            '{urlContactEdit}' +
                            '&contactID=' + escape(document.getElementById("delContactID").value) +
                            '&parentIDField=delContactID' +
                            '&parentDescField=delContactName',
                            'address', 'scrollbars=yes,resizable=yes,height=550,width=500,copyhistory=no, menubar=0');
                    }
                    break;
            }
        }
        return;
    }

    function selectionChanged() {
        if ($("#action").val() == "changeSupplier") {
            $("input#updateSupplierName").show();
        } else {
            $("input#updateSupplierName").hide();
        }
    }

    function checkCreation() {
        if (this.event.target.parentElement.className === 'createItem') {
            if (!confirm('Are you sure you want to create this renewal item?')) {
                this.event.preventDefault();
                return false;
            }
            this.event.target.style.color = "green";
        }
    }

    let actionSelector;
    let supplierToChangeId;
    let salutationInput;
    let introductionTextArea;
    let emailSubjectInput;
    let orderHeadIdInput;
    let toggleCheckBoxes;

    document.addEventListener('DOMContentLoaded', () => {
        window.fromDate = $('#fromDate').get(0);
        window.toDate = $('#toDate').get(0);

        const oneOffSortableJQuery = $('.sortableLines');
        oneOffSortableJQuery.sortable({
            axis: "y",
            tolerance: "pointer",
            containment: 'parent',
            update: (event, ui) => {
                const lineData = ui.item.data();
                const movingLineId = lineData.lineId;
                const fromSequenceNo = lineData.sequenceNo;
                let swappedItem = ui.item.next();
                if (ui.position.top > ui.originalPosition.top) {
                    swappedItem = ui.item.prev();
                }
                const toSequenceNo = swappedItem.data().sequenceNo;
                const replacedLineId = swappedItem.data().lineId;
                fetch('?action=MOVE_LINE_TO_POSITION', {
                    method: 'POST',
                    body: JSON.stringify(
                        {
                            lineId: movingLineId,
                            replacedLineId,
                        }
                    )
                })
                    .then(() => {
                        // we have to update the sequences of the items to match the new ordering
                        const siblings = ui.item.parent().children();
                        let lowerBound = fromSequenceNo;
                        let upperBound = toSequenceNo;
                        if (lowerBound > upperBound) {
                            upperBound = fromSequenceNo;
                            lowerBound = toSequenceNo;
                        }

                        for (let i = lowerBound - 1; i < upperBound; i++) {
                            siblings[i].dataset.sequenceNo = (i + 1).toString();
                        }
                    })
                    .catch(errorResponse => {
                        alert('Failed to move line');
                        console.error(errorResponse);
                        oneOffSortableJQuery.sortable('cancel');
                    })

            }
        });
        selectionChanged();

        actionSelector = document.querySelector('#actionSelector');
        supplierToChangeId = document.querySelector('#updateSupplierID');
        salutationInput = document.querySelector('#salutation');
        introductionTextArea = document.querySelector('#introduction');
        emailSubjectInput = document.querySelector('#emailSubject');
        orderHeadIdInput = document.querySelector('[name="form[ordheadID]"]');
        toggleCheckBoxes = document.querySelectorAll('[name="Toggle"]');

        toggleCheckBoxes.forEach(el => {
            el.addEventListener('change', $event => {
                const parentTable = el.closest('table');
                const checkBoxes = parentTable.querySelectorAll('tbody input[type="checkbox"]');
                checkBoxes.forEach(checkBox => {
                    checkBox.checked = el.checked;
                })
            })
        })

        document.querySelectorAll('.lineItemQuantityOrdered').forEach(el => {
            el.addEventListener('input', handleQuantityChanged)
            el.addEventListener('change', handleUpdateLine);
        })

        document.querySelectorAll('.lineItemUnitCost').forEach(el => {
            el.addEventListener('input', handleUnitCostChange)
            el.addEventListener('change', handleUpdateLine);
        })
        document.querySelectorAll('.lineItemUnitSale').forEach(el => {
            el.addEventListener('input', handleUnitSaleChange)
            el.addEventListener('change', handleUpdateLine);
        })

        document.querySelectorAll('.updateItemPriceButton').forEach(el => {
            el.addEventListener('click', handleUpdateItemPrice);
        })


        function confirmOption(text) {
            return confirm('Are you sure you want to ' + text);
        }

        function getSelectedLines() {
            const selectedLines = [];
            document.querySelectorAll('[name="selectedOrderLine[]"]:checked').forEach((selectedCheckbox) => {
                selectedLines.push(selectedCheckbox.value);
            });
            return selectedLines;
        }

        document.querySelector('#performActionButton').addEventListener('click', $event => {
            console.log('perform action');
            if (!actionSelector.selectedOptions.length) {
                return;
            }

            const selectedOptionText = actionSelector.selectedOptions[0].value;

            switch (selectedOptionText) {
                case 'change supplier':
                    if (!supplierToChangeId.value) {
                        alert('Please select a Supplier');
                        return;
                    }

                    if (!confirmOption(selectedOptionText)) {
                        return;
                    }

                    // todo: update the supplier for the given lines
                    break;
                case 'DELETE_LINES': {
                    const selectedLines = getSelectedLines();

                    if (!selectedLines.length) {
                        alert('Please select at least 1 line to proceed');
                        return;
                    }

                    // todo: try to generate the quote
                    fetch('?action=DELETE_LINES',
                        {
                            method: 'POST',
                            body: JSON.stringify({
                                selectedLines,
                            })
                        }
                    )
                        .then(response => response.json())
                        .then(response => {
                            if (response.status == 'error') {
                                throw new Error(response.message);
                            }
                            document.location.reload();
                        })
                        .catch(error => {
                            alert(error.message);
                        })
                    break
                }


                case 'CREATE_SIGNABLE_QUOTE':

                    const salutation = salutationInput.value;
                    const introduction = introductionTextArea.value;
                    const emailSubject = emailSubjectInput.value;
                    const orderHeadId = orderHeadIdInput.value;

                    if (!salutation || !introduction || !emailSubject) {
                        alert('Please make sure you have set Salutation, Email Subject and Introduction before trying again');
                        return;
                    }
                    const selectedLines = getSelectedLines();

                    if (!selectedLines.length) {
                        alert('Please select at least 1 line to proceed');
                        return;
                    }

                    // todo: try to generate the quote
                    fetch('?action=CREATE_SIGNABLE_QUOTE',
                        {
                            method: 'POST',
                            body: JSON.stringify({
                                selectedLines,
                                salutation,
                                introduction,
                                emailSubject,
                                orderHeadId
                            })
                        }
                    )
                        .then(response => response.json())
                        .then(response => {
                            if (response.status == 'error') {
                                throw new Error(response.message);
                            }
                            document.location.reload();
                        })
                        .catch(error => {
                            alert(error.message);
                        })

                    break;
            }
        })

        function handleUpdateItemPrice($event) {
            const target = $event.target;
            const parentRow = target.closest('tr');
            const unitSale = parentRow.querySelector('.lineItemUnitSale').value;
            const unitCost = parentRow.querySelector('.lineItemUnitCost').value;
            const lineId = parentRow.dataset.lineId;
            fetch('?action=UPDATE_ITEM_PRICE', {
                method: 'POST',
                body: JSON.stringify({
                    lineId,
                    unitSale,
                    unitCost
                })
            })
                .then(() => {
                    alert('Price updated');
                })
                .catch(() => {
                    alert('Failed to update price');
                })
        }

        function handleUpdateLine($event) {
            const target = $event.target;
            const parentRow = target.closest('tr');
            const unitSale = parentRow.querySelector('.lineItemUnitSale').value;
            const quantity = parentRow.querySelector('.lineItemQuantityOrdered').value;
            const unitCost = parentRow.querySelector('.lineItemUnitCost').value;

            const rowOverlay = document.createElement('div');
            const trPosition = parentRow.getBoundingClientRect();
            rowOverlay.style.height = String(trPosition.height) + "px";
            rowOverlay.style.width = String(trPosition.width) + "px";
            rowOverlay.style.position = 'fixed';
            rowOverlay.style.left = String(trPosition.left) + "px";
            rowOverlay.style.top = String(trPosition.top) + "px";
            rowOverlay.style.backgroundColor = "rgba(255, 255, 255, 0.8)";
            const indicatorHolder = document.createElement('div');
            indicatorHolder.style.position = 'relative';

            const indicator = document.createElement('div');
            indicator.className = "loading";
            indicator.style.top = String(trPosition.height);
            indicatorHolder.append(indicator);
            rowOverlay.append(indicatorHolder);
            document.body.append(rowOverlay);

            fetch('?action=UPDATE_LINE_VALUES', {
                method: 'POST',
                body: JSON.stringify({
                    lineId: parentRow.dataset.lineId,
                    unitSale,
                    quantity,
                    unitCost,
                })
            })
                .catch(() => {
                    alert('Failed trying to save');
                })
                .then(() => {
                    rowOverlay.parentNode.removeChild(rowOverlay);
                })

        }

        function getCalculatedValues(quantity, unitCost, unitSale) {
            const totalCost = unitCost * quantity;
            const totalSale = unitSale * quantity;
            const profitAmount = totalSale - totalCost;
            const profitPercentage = totalCost ? profitAmount / totalCost * 100 : 0;
            return {
                totalCost,
                totalSale,
                profitAmount,
                profitPercentage
            }
        }


        function updateRowCalculatedValues(row, quantity, unitCost, unitSale) {
            const calculatedValues = getCalculatedValues(quantity, unitCost, unitSale);
            row.querySelector('.lineItemCostTotal').textContent = calculatedValues.totalCost.toFixed(2);
            row.querySelector('.lineItemSaleTotal').textContent = calculatedValues.totalSale.toFixed(2);
            const lineItemProfitAmount = row.querySelector('.lineItemProfitAmount');
            lineItemProfitAmount.textContent = calculatedValues.profitAmount.toFixed(2);
            if (calculatedValues.profitAmount < 0) {
                lineItemProfitAmount.classList.add('orderLineLoss');
            } else {
                lineItemProfitAmount.classList.remove('orderLineLoss');
            }
            const lineItemProfitPercentage = row.querySelector('.lineItemProfitPercentage');
            lineItemProfitPercentage.textContent = calculatedValues.profitPercentage.toFixed(2);
            if (calculatedValues.profitPercentage < 0) {
                lineItemProfitPercentage.classList.add('orderLineLoss');
            } else {
                lineItemProfitPercentage.classList.remove('orderLineLoss');
            }
            const tbody = row.closest('tbody');
            const grandTotals = Array.from(tbody.querySelectorAll('tr')).reduce((sums, tr) => {
                const lineItemCostTotalInput = tr.querySelector('.lineItemCostTotal');
                if (!lineItemCostTotalInput) {
                    return sums;
                }
                sums.costGrandTotal += parseFloat(tr.querySelector('.lineItemCostTotal').textContent);
                sums.saleGrandTotal += parseFloat(tr.querySelector('.lineItemSaleTotal').textContent);
                sums.profitAmountGrandTotal += parseFloat(tr.querySelector('.lineItemProfitAmount').textContent);
                return sums;
            }, {
                costGrandTotal: 0,
                saleGrandTotal: 0,
                profitAmountGrandTotal: 0
            })
            const footer = row.closest('table').querySelector('tfoot');
            footer.querySelector('.costGrandTotal').textContent = grandTotals.costGrandTotal.toFixed(2);
            footer.querySelector('.saleGrandTotal').textContent = grandTotals.saleGrandTotal.toFixed(2);
            footer.querySelector('.profitAmountGrandTotal').textContent = grandTotals.profitAmountGrandTotal.toFixed(2);
        }

        function handleQuantityChanged($event) {
            // get the parent row
            const target = $event.target;
            const quantityValue = target.value;
            const parentRow = target.closest('tr');
            const unitCost = parentRow.querySelector('.lineItemUnitCost').value;
            const unitSale = parentRow.querySelector('.lineItemUnitSale').value;
            updateRowCalculatedValues(parentRow, quantityValue, unitCost, unitSale);
        }

        function handleUnitCostChange($event) {
            const target = $event.target;
            const unitCost = target.value;
            const parentRow = target.closest('tr');
            const quantity = parentRow.querySelector('.lineItemQuantityOrdered').value;
            const unitSale = parentRow.querySelector('.lineItemUnitSale').value;
            updateRowCalculatedValues(parentRow, quantity, unitCost, unitSale);
        }

        function handleUnitSaleChange($event) {
            const target = $event.target;
            const unitSale = target.value;
            const parentRow = target.closest('tr');
            const quantity = parentRow.querySelector('.lineItemQuantityOrdered').value;
            const unitCost = parentRow.querySelector('.lineItemUnitCost').value;
            updateRowCalculatedValues(parentRow, quantity, unitCost, unitSale);
        }


    })

</script>

{salesOrderLineEditJS} {salesOrderSiteEditJS}
{projectLink}
<div style="position: sticky; top: -1px; background: white;padding-top: 6px">
    <TABLE width="1000px"
           border="0"
           cellpadding="2"
           cellspacing="1"
    >
        <TR>
            <TD width="100px"
                class="navigateLink"
                valign="top"
            ><a href="{urlDeleteOrder}"
                onClick="if(!confirm('Are you sure you want to remove this quote?')) return(false)"
            >{txtDeleteOrder}</a>
            </TD>
            <TD width="100px"
                class="navigateLink"
                valign="top"
            ><a href="{urlPurchaseOrders}">{txtPurchaseOrders}</a>
            </TD>
            <TD width="100px"
                class="navigateLink"
                valign="top"
            ><a href="{urlInvoices}">{txtInvoices}</a>
            </TD>
            <TD width="100px"
                class="navigateLink"
                valign="top"
            ><a href="{urlDespatch}">{txtDespatch}</a>
            </TD>
            <TD width="100px"
                class="navigateLink"
                valign="top"
            > {linkServiceRequest}
            </TD>
            <TD width="100px"
                class="navigateLink"
                valign="top"
            ><a href="{urlRenewalReport}"
                target="_blank"
            >{txtRenewalReport}</a>
            </TD>
            <TD width="100px"
                class="navigateLink"
                valign="top"
            ><a href="javascript:"
                onclick="customerNotePopup()"
            >{txtCustomerNote}</a></TD>
            <TD width="100px"
                class="navigateLink"
                valign="top"
            >
            </TD>
            <TD width="100px"
                valign="top"
            >{uncSalesOrderConf}
            </TD>
        </TR>
    </table>
    <br/>
    {salesOrderHeadDisplay} {salesOrderDisplayNewLine}
    <table>
        <tbody>
        <tr>
            <td colspan="7">
                <input
                        type="hidden"
                        name="form[updateSupplierID]"
                        id="updateSupplierID"
                        value="{updateSupplierID}"
                >

                <select {readOnly}
                        id="actionSelector"
                        onChange="selectionChanged()"
                >
                    <!-- BEGIN actionBlock -->
                    <option {SELECTED}
                            value="{action}"
                            {disabled}
                    >{actionDescription}
                    </option>
                    <!-- END actionBlock -->
                </select>
                <input
                        {fromOrdheadIDStyle}
                        type="text"
                        name="form[fromOrdheadID]"
                        id="fromOrdheadID"
                        value="{fromOrdheadID}"
                        placeholder="From Sales Order ID"
                >
                <input {updateSupplierNameStyle}
                       type="text"
                       name="form[updateSupplierName]"
                       id="updateSupplierName"
                       value="{updateSupplierName}"
                       onChange="javascript:validateUpdateSupplierName()"
                       onKeydown="javascript:checkFunctionKey(updateSupplierName)"
                       size="35"
                       maxlength="50"
                       placeholder="Supplier Name or ID"
                >
                <font class="formErrorMessage">{updateSupplierNameMessage}</font>
                <button id="performActionButton"
                        {readOnly}
                        type="button"

                >Go
                </button>
                <font class="formErrorMessage">{linesMessage}</font>
            </td>
        </tr>
        </tbody>
    </table>

</div>
<INPUT type="hidden"
       id="updatedTime"
       name="updatedTime"
       value="{updatedTime}"
>
<form name="quickQuoteForm"
      method="POST"
      enctype="multipart/form-data"
      action="{urlSubmitOrderLines}"
>
    <input type="hidden"
           name="form[ordheadID]"
           value="{ordheadID}"
    >
    <input type="hidden"
           name="form[serviceRequestCustomerItemID]"
           value="{serviceRequestCustomerItemID}"
    >
    <input type="hidden"
           name="form[serviceRequestText]"
           value="{serviceRequestText}"
    >
    <input type="hidden"
           name="form[ordheadID]"
           value="{ordheadID}"
    >

    <table class="singleBorder sortableTable"
           width="970"
           border="0"
           cellspacing="1"
           cellpadding="1"
    >
        <thead>
        <tr>
            <td width="16px"
                class="listHeadText"
            >
                <input type="checkbox"
                       name="Toggle"
                >
            </td>
            <td width="10px"
                class="listHeadText"
            >&nbsp;
            </td>
            <td width="242px"
                class="listHeadText"
            >Description
            </td>
            <td width="57px"
                class="listHeadText"
            >Part No
            </td>
            <td width="125px"
                class="listHeadText"
            >Supplier
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Qty</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Cost(&pound;)</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Total(&pound;)</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Sale(&pound;)</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Total(&pound;)</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Profit(&pound;)</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Profit(%)</DIV>
            </td>
            <td width="100px"
                class="orderLineClass"
            >
                <div align="left">{salesOrderDisplayCreatePO}</div>
            </td>
        </tr>
        </thead>
        <tbody class="sortableLines"
               style="padding-top: 5px;"
        >
        <!-- BEGIN orderLineBlock -->
        {salesOrderLine}
        <!-- END orderLineBlock -->
        </tbody>
        <tfoot>
        <tr>
            <td>&nbsp;</td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="orderTotalItem">
                <DIV align="left"> Totals</DIV>
            </td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="{orderTotalCostClass} costGrandTotal">{curCostGrandTotal}</td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="{orderTotalSaleClass} saleGrandTotal">{curSaleGrandTotal}</td>
            <td class="{orderTotalProfitClass} profitAmountGrandTotal">{curProfitGrandTotal}</td>
            <td class="{orderTotalProfitClass}">{percProfitGrandTotal}</td>
            <td class="{orderTotalItem}">&nbsp;</td>
        </tr>
        </tfoot>
    </table>
    <table class="singleBorder sortableTable"
           width="970"
           border="0"
           cellspacing="1"
           cellpadding="1"
    >
        <thead>


        <tr>
            <td width="16px"
                class="listHeadText"
            >
                <input type="checkbox"
                       name="Toggle"
                >
            </td>
            <td width="10px"
                class="listHeadText"
            >&nbsp;
            </td>
            <td width="242px"
                class="listHeadText"
            >Description
            </td>
            <td width="57px"
                class="listHeadText"
            >Part No
            </td>
            <td width="125px"
                class="listHeadText"
            >Supplier
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Qty</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Cost(&pound;)</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Total(&pound;)</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Sale(&pound;)</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Total(&pound;)</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Profit(&pound;)</DIV>
            </td>
            <td width="50px"
                class="listHeadText"
            >
                <DIV align="right">Profit(%)</DIV>
            </td>
            <td width="100px"
                class="orderLineClass"
            >
                <div align="left">{salesOrderDisplayCreatePO}</div>
            </td>
        </tr>
        </thead>
        <tbody class="sortableLines">

        <!-- BEGIN recurringOrderLineBlock -->
        {salesOrderLine}
        <!-- END recurringOrderLineBlock -->
        </tbody>
        <tfoot>
        <tr>
            <td>&nbsp;</td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="orderTotalItem">
                <DIV align="left"> Totals</DIV>
            </td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="{recurringOrderTotalCostClass}">{recurringCurCostGrandTotal}</td>
            <td class="orderTotalItem">&nbsp;</td>
            <td class="{recurringOrderTotalSaleClass}">{recurringCurSaleGrandTotal}</td>
            <td class="{recurringOrderTotalProfitClass}">{recurringCurProfitGrandTotal}</td>
            <td class="{recurringOrderTotalProfitClass}">{recurringPercProfitGrandTotal}</td>
            <td class="{orderTotalItem}">&nbsp;</td>
        </tr>
        </tfoot>
    </table>
    {salesOrderGenerateQuotes}

</form>
{salesOrderDisplayQuotes}
<table width="700px"
       border="0"
       cellspacing="0"
       cellpadding="1"
>
    <tr>
        <form name="ordheadinv"
              method="post"
              action="{urlUpdateInvAddress}"
        >
            <INPUT type="hidden"
                   name="updatedTime"
                   value="{updatedTime}"
            >
            <td valign="top"
                class="mainHeadText"
            >
                <table class="singleBorder"
                       width="348px"
                       border="0"
                       cellspacing="1"
                       cellpadding="2"
                >
                    <tr>
                        <td valign="top"
                            class="listHeadText"
                        >
                            <div align="center">Invoice
                                Address
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top"
                            class="mainHeadText"
                        ><P class="addressLine">{invAdd1}</P>
                            <P class="addressLine">{invAdd2}</P>
                            <P class="addressLine">{invAdd3}</P>
                            <P class="addressLine">{invTown}</P>
                            <P class="addressLine">{invCounty}</P>
                            <P class="addressLine">{invPostcode}</P></td>
                    </tr>
                    <tr>
                        <td class="mainHeadText">
                            <input type="hidden"
                                   name="form[ordheadID]"
                                   value="{ordheadID}"
                            >
                            <input type="hidden"
                                   name="form[siteNo]"
                                   id="invSiteNo"
                                   value="{invSiteNo}"
                            >
                            <input
                                    type="text"
                                    name="form[invSiteDesc]"
                                    id="invSiteDesc"
                                    value="{invSiteDesc}"
                                    onKeydown="javascript:checkFunctionKey(invSiteDesc)"
                                    onChange="javascript:validateInvSiteDesc()"
                                    {readOnly}
                                    size="50"
                                    maxlength="50"
                            > <input
                                type="text"
                                name="blah"
                                style="display:none"
                        > <input
                                type="button"
                                name="SubmitInvAdd"
                                {readOnly}
                                value="Select"
                                onClick="form.submit();"
                        ></td>
                    </tr>
                </table>
            </td>
        </form>
        <form name="ordheaddel"
              method="post"
              action="{urlUpdateDelAddress}"
        >
            <INPUT type="hidden"
                   name="updatedTime"
                   value="{updatedTime}"
            >
            <td valign="top">
                <table class="singleBorder"
                       width="348px"
                       border="0"
                       cellspacing="1"
                       cellpadding="2"
                >
                    <tr>
                        <td valign="top"
                            class="listHeadText"
                        >
                            <div align="center">Delivery
                                Address
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top"
                            class="mainHeadText"
                        ><P class="addressLine">{delAdd1}</P>
                            <P class="addressLine">{delAdd2}</P>
                            <P class="addressLine">{delAdd3}</P>
                            <P class="addressLine">{delTown}</P>
                            <P class="addressLine">{delCounty}</P>
                            <P class="addressLine">{delPostcode}</P></td>
                    </tr>
                    <tr>
                        <td class="mainHeadText"><input type="hidden"
                                                        name="form[ordheadID]"
                                                        value="{ordheadID}"
                        >
                            <input type="hidden"
                                   name="form[siteNo]"
                                   id="delSiteNo"
                                   value="{delSiteNo}"
                            >
                            <input
                                    type="text"
                                    name="form[delSiteDesc]"
                                    id="delSiteDesc"
                                    value="{delSiteDesc}"
                                    {readOnly}
                                    onKeydown="javascript:checkFunctionKey(delSiteDesc)"
                                    onChange="javascript:validateDelSiteDesc()"
                                    size="50"
                                    maxlength="50"
                            > <input
                                    type="text"
                                    name="blah"
                                    style="display:none"
                            > <input type="button"
                                     name="SubmitDelAdd"
                                     value="Select"
                                     onClick="form.submit();"
                                     {readOnly}
                            >
                        </td>
                    </tr>
                </table>
            </td>
        </form>
    </tr>
</table>
<table width="700px"
       border="0"
       cellspacing="0"
       cellpadding="1"
>
    <tr>
        <td width="50%"
            class="mainHeadText"
        >
            <table class="singleBorder"
                   width="348px"
                   border="0"
                   cellspacing="1"
                   cellpadding="2"
            >
                <tr>
                    <td colspan="2"
                        valign="top"
                        class="listHeadText"
                    >
                        <div align="center">Invoice
                            Contact
                        </div>
                    </td>
                </tr>
                <tr>
                    <td width="60px"
                        class="promptText"
                    >Contact
                    </td>
                    <td width="400px"
                        class="mainHeadText"
                    >{invContact}
                    </td>
                </tr>
                <tr>
                    <td width="60px"
                        class="promptText"
                    >Email
                    </td>
                    <td class="mainHeadText"><a href="mailto:{invContactEmail}">{invContactEmail}</a></td>
                </tr>
                <tr>
                    <td width="60px"
                        class="promptText"
                    >DDI
                    </td>
                    <td class="mainHeadText"><a href="tel:{invContactPhone}">{invContactPhone}</a></td>
                </tr>
                <tr>
                    <td width="60px"
                        class="promptText"
                    >Switchboard
                    </td>
                    <td class="mainHeadText"><a href="tel:{invSitePhone}">{invSitePhone}</a></td>
                </tr>
                <tr>
                    <td width="60px"
                        class="promptText"
                    >Fax
                    </td>
                    <td class="mainHeadText">{invContactFax}</td>
                </tr>
                <tr>
                    <form name="invcon"
                          method="post"
                          action="{urlUpdateInvContact}"
                    >
                        <INPUT type="hidden"
                               name="updatedTime"
                               value="{updatedTime}"
                        >
                        <td colspan="2"
                            class="mainHeadText"
                        ><input type="hidden"
                                name="form[ordheadID]"
                                value="{ordheadID}"
                        >
                            <input type="hidden"
                                   name="form[contactID]"
                                   id="invContactID"
                                   value="{invContactID}"
                            >
                            <input
                                    type="text"
                                    name="form[invContactName]"
                                    id="invContactName"
                                    value="{invContactName}"
                                    onKeydown="javascript:checkFunctionKey(invContactName)"
                                    onChange="javascript:validateInvContactName()"
                                    {readOnly}
                                    size="50"
                                    maxlength="50"
                            > <input
                                    type="text"
                                    name="blah"
                                    style="display:none"
                            > <input type="button"
                                     name="SubmitInvContact"
                                     value="Select"
                                     onClick="form.submit();"
                                     {readOnly}
                            >
                        </td>
                    </form>
                </tr>
            </table>
        </TD>
        <td width="50%"
            class="mainHeadText"
        >
            <table class="singleBorder"
                   width="348px"
                   border="0"
                   cellspacing="1"
                   cellpadding="2"
            >
                <tr>
                    <td colspan="2"
                        valign="top"
                        class="listHeadText"
                    >
                        <div align="center">Delivery Contact</div>
                    </td>
                </tr>
                <tr>
                    <td width="60px"
                        class="promptText"
                    >Contact
                    </td>
                    <td width="400px"
                        class="mainHeadText"
                    >{delContact}
                    </td>
                </tr>
                <tr>
                    <td width="60px"
                        class="promptText"
                    >Email
                    </td>
                    <td class="mainHeadText"><a href="mailto:{delContactEmail}">{delContactEmail}</a></td>
                </tr>
                <tr>
                    <td width="60px"
                        class="promptText"
                    >DDI
                    </td>
                    <td class="mainHeadText"><a href="tel:{delContactPhone}">{delContactPhone}</a></td>
                </tr>
                <tr>
                    <td width="60px"
                        class="promptText"
                    >Switchboard
                    </td>
                    <td class="mainHeadText"><a href="tel:{delSitePhone}">{delSitePhone}</a></td>
                </tr>
                <tr>
                    <td width="60px"
                        class="promptText"
                    >Fax
                    </td>
                    <td class="mainHeadText">{delContactFax}</td>
                </tr>
                <tr>
                    <form name="delcon"
                          method="post"
                          action="{urlUpdateDelContact}"
                    >
                        <INPUT type="hidden"
                               name="updatedTime"
                               value="{updatedTime}"
                        >
                        <td colspan="2"
                            class="mainHeadText"
                        ><input type="hidden"
                                name="form[ordheadID]"
                                value="{ordheadID}"
                        >
                            <input type="hidden"
                                   name="form[contactID]"
                                   id="delContactID"
                                   value="{delContactID}"
                            >
                            <input
                                    type="text"
                                    name="form[delContactName]"
                                    id="delContactName"
                                    value="{delContactName}"
                                    onKeydown="javascript:checkFunctionKey(delContactName)"
                                    onChange="javascript:validateDelContactName()"
                                    {readOnly}
                                    size="50"
                                    maxlength="50"
                            > <input
                                    type="text"
                                    name="blah"
                                    style="display:none"
                            > <input type="button"
                                     name="SubmitDelContact"
                                     value="Select"
                                     onClick="form.submit();"
                                     {readOnly}
                            >
                        </td>
                    </form>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td>{salesOrderHeadAmend}</td>
        <td>{salesOrderDisplayDocuments}</td>
    </tr>
    <tr>
        <td>{despatchDisplayNotes}</td>
        <td></td>
    </tr>
</table>
<!-- End Template: SalesOrderDisplay.inc.html -->