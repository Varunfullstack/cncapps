<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    // Load the Visualization API and the corechart package.
    google.charts.load('current', {'packages': ['corechart']});

    // Set a callback to run when the Google Visualization API is loaded.

    google.charts.setOnLoadCallback(drawChart);

    needToFetch = false;

    membersOptions = {};

    days = 30;
    team = 1;
    var data = $.ajax(
        {
            url: '?action=lastWeekHelpDesk',
            dataType: 'json',
            data: {days: days, team: team}
        }
    );
    $(function () {
        $('#daysSelector').change(function () {
            console.log($(this).val());

            data = $.ajax(
                {
                    url: '?action=lastWeekHelpDesk',
                    dataType: 'json',
                    data: {days: $(this).val(), team: team}
                }
            );
            drawChart();
        });

        $('#membersSelectors input').change(function () {
            console.log('changed ' + this);
        })
    });

    // Callback that creates and populates a data table,
    // instantiates the pie chart, passes in the data and
    // draws it.
    function drawChart() {


        data.then(function (result) {
            var membersSelectors = $('#membersSelectors');
            membersSelectors.html('');

            Object.keys(result.members).forEach(function (memberKey) {

                if (membersOptions[memberKey] == null) {
                    membersOptions[memberKey] = true;
                }

                membersSelectors.append('<div><label>' + result.members[memberKey] +
                    '</label><input type="checkbox" id="' + memberKey + '" ' + (membersOptions[memberKey] ? 'checked' : '') + '></div>')
            });

            var data = new google.visualization.DataTable(result.data);

            // Set chart options
            var options = {
                'title': 'How Much Pizza I Ate Last Night',
                'width': 800,
                'height': 600,
                series: {
                    0: {lineDashStyle: [1, 1], lineWidth: 6},
                    1: {lineWidth: 8}
                }
            };

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
            chart.draw(data, options);

        });

        // Create the data table
    }


</script>
<div>
    Members:
    <div id="membersSelectors">

    </div>
</div>
<div>
    <select name="days" id="daysSelector">
        <option value="7">last 7 Days</option>
        <option value="30" selected>last 30 Days</option>
        <option value="180">last 6 Months</option>
        <option value="365">last Year</option>
    </select>
</div>

<div id="chart_div"></div>
{test}