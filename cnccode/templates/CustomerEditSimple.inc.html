<!-- Template: CustomerEdit.inc.html -->
<script language='JavaScript'
        src='.javascript/ajax.js'
></script>
<style>


    table.content tbody td {
        background-color: #F4f4f2;
        text-align: left;
        padding: 5px;
        vertical-align: top;
        white-space: nowrap;
    }

    table.content tbody td.center {
        text-align: center;
    }

    .contactError input {
        border-color: red;
    }

    .lockedIcon::before {
        font-family: "FontAwesome";
        content: '\f023';
        color: green;
    }

    .unlockedIcon::before {
        font-family: "FontAwesome";
        content: '\f13e';
        color: red;
    }

    td.has-error {
        background-color: red !important;
    }

    fieldset label {
        height: 20px;
        width: 140px;
        margin-left: 10px;
        text-align: right;
        clear: both;
        float: left;
        margin-right: 15px;
        margin-top: 10px;
    }

    fieldset input {
        height: 20px;
        width: 200px;
        border: 1px solid #000;
        margin-top: 10px;
        float: left;
    }

    fieldset .comment {
        float: left;
        margin-top: 10px;
    }

    .redText td input, .redText td textarea, .redText td select, .redText td button {
        color: red !important;
    }

</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.3.26/jquery.form-validator.js"
></script>
<div id="newPasswordDialog"
     title="New Password"
>
    <fieldset id="register">
        <label>Password </label>
        <input type="password"
               id="password"
        >
        <span class="comment"
              id="passwordComment"
        ></span>
        <label>Repeat Password </label>
        <input type="password"
               id="repeatPassword"
        >
        <span class="comment"
              id="repeatPasswordComment"
        ></span>
    </fieldset>
    <br>
    <div>
        <button onclick="saveNewPassword()"
                disabled
                id="savePasswordButton"
        >Save
        </button>
        <button onclick="cancelNewPassword()">Cancel</button>
    </div>
</div>
<script type="text/JavaScript">
    var currentContactId = null;
    var currentPasswordButton = null;

    function resetPasswordFields() {
        $('#password').val(null);
        $('#repeatPassword').val(null);
    }

    function cancelNewPassword() {
        $('#newPasswordDialog').dialog('close');
    }

    function saveNewPassword() {
        var object = {
            password: $('#password').val(),
            contactID: currentContactId
        };

        $.ajax({
            url: '?action=saveContactPassword',
            method: 'POST',
            type: 'post',
            dataType: 'json',
            data: object
        }).then(function (result) {
            if (result.status == 'error') {
                throw 'Failed to save password';
            } else {
                alert('Submitted OK');
                if ($(currentPasswordButton).hasClass('unlockedIcon')) {
                    $(currentPasswordButton).removeClass('unlockedIcon').addClass('lockedIcon');
                }
            }
        }).catch(function (error) {
            alert('Failed to save password');
            resetPasswordFields();
        }).then(function () {
            $('#newPasswordDialog').dialog('close');
        });
    }

    $('#newPasswordDialog').dialog({
        autoOpen: false, width: 500, close: function () {
            resetPasswordFields();
        }
    });


    function askNewPassword() {
        var data = $(event.target).data();
        currentContactId = data.contactId;
        currentPasswordButton = event.target;
        $('#newPasswordDialog').dialog('open');
    }

    var validPassword = false;
    var validRepeatPassword = false;

    $(function () {


        $('#password').keyup(function () {
            $('#passwordComment').html(checkStrength($('#password').val()));
            checkSavePassword();
        });

        $('#repeatPassword').keyup(function () {
            $('#repeatPasswordComment').html(checkPasswordEqual($('#password').val(), $('#repeatPassword').val()));
            checkSavePassword();
        });

        function checkSavePassword() {
            if (validPassword && validRepeatPassword) {
                $('#savePasswordButton').prop("disabled", false);
            } else {
                $('#savePasswordButton').prop("disabled", true);
            }
        }

        function checkPasswordEqual(password, repeatPassword) {
            validRepeatPassword = false;
            if (!password || !repeatPassword) {
                return null;
            }

            if (password != repeatPassword) {
                return 'Not Equal';
            }
            validRepeatPassword = true;
            return null;
        }

        function checkStrength(password) {
            validPassword = false;
            if (!password) {
                return false;
            }

            var strength = 0;
            if (password.length < 6) {
                return 'Too short'
            }

            if (password.match(/([a-z])/)) strength += 1;
            if (password.match(/([A-Z])/)) strength += 1;
            if (password.match(/([0-9])/)) strength += 1;
            if (password.match(/([!,%,&,@,#,$,^,*,?,_,~])/)) strength += 1;
// Calculated strength value, we can return messages
// If value is less than 2
            if (strength < 3) {
                $('#result').removeClass();
                $('#result').addClass('weak');
                return 'Weak'
            } else if (strength >= 3) {
                $('#result').removeClass();
                $('#result').addClass('good');
                validPassword = true;
                return null
            }
        }


        var config = {
            modules: 'security',
            inlineErrorMessageCallback: function (error, element) {

            },
            scrollToTopOnError: false
        };
        $.validate(config);

        $.formUtils.addValidator({
            name: 'emailOrEmpty',
            validatorFunction: function (email) {

                if (email === '') {
                    return true;
                }

                var emailParts = email.toLowerCase().split('@'),
                    localPart = emailParts[0],
                    domain = emailParts[1];

                if (localPart && domain) {

                    if (localPart.indexOf('"') === 0) {
                        var len = localPart.length;
                        localPart = localPart.replace(/\"/g, '');
                        if (localPart.length !== (len - 2)) {
                            return false; // It was not allowed to have more than two apostrophes
                        }
                    }

                    return $.formUtils.validators.validate_domain.validatorFunction(emailParts[1]) &&
                        localPart.indexOf('.') !== 0 &&
                        localPart.substring(localPart.length - 1, localPart.length) !== '.' &&
                        localPart.indexOf('..') === -1 &&
                        !(/[^\w\+\.\-\#\-\_\~\!\$\&\'\(\)\*\+\,\;\=\:]/.test(localPart));
                }

                return false;
            },
            errorMessage: '',
            errorMessageKey: 'badEmail'
        });

        $.formUtils.addValidator({
            name: 'atLeastOne',
            validatorFunction: function (value, $el, config, language, $form) {
                var test = $('[data-type="' + $el.data().type + '"]');
                var isValid = false;
                var except = test.data().except;
                var exceptCondition = eval(except);
                test.each(function () {
                    var elm = $(this);
                    var isMe = elm.get(0) === $el.get(0);

                    if (elm.prop('checked')) {
                        isValid = true;
                    }

                    if (!$el.data().toBeValidated && !isMe) {
                        elm.data("toBeValidated", true);
                        elm.validate();
                    }
                });

                $el.data("toBeValidated", false);
                if (exceptCondition) {
                    return true;
                }
                return isValid;
            },
            errorMessage: '',
            errorMessageKey: 'atLeastOne'
        });

        $.formUtils.addValidator({
            name: 'atLeastOneAtMostOne',
            validatorFunction: function (value, $el, config, language, $form) {
                var test = $('[data-type="' + $el.data().type + '"]');

                var checkedCount = 0;

                test.each(function () {
                    var elm = $(this);
                    var isMe = elm.get(0) === $el.get(0);

                    if (elm.prop('checked')) {
                        checkedCount++;
                    }

                    if (!$el.data().toBeValidated && !isMe) {
                        elm.data("toBeValidated", true);
                        elm.validate();
                    }
                });
                var except = test.data().except;
                var exceptCondition = eval(except);
                $el.data("toBeValidated", false);

                if (exceptCondition) {
                    return true;
                }

                return checkedCount === 1;
            },
            errorMessage: '',
            errorMessageKey: 'atLeastOne'
        });

        $.formUtils.addValidator({
            name: 'atLeastOneMain',
            validatorFunction: function (value, $el, config, language, $form) {
                var test = $('[data-type="' + $el.data().type + '"]');

                var checkedCount = 0;
                var except = test.data().except;
                var exceptCondition = eval(except);
                test.each(function () {
                    var elm = $(this);
                    var isMe = elm.get(0) === $el.get(0);

                    if (elm.val() === 'main') {
                        checkedCount++;
                    }

                    if (!$el.data().toBeValidated && !isMe) {
                        elm.data("toBeValidated", true);
                        elm.validate();
                    }
                });
                $el.data("toBeValidated", false);

                if (exceptCondition) {
                    return true;
                }
                return checkedCount > 0;
            }
        });

        window.specialAttentionEndDate = $('#specialAttentionEndDate').get(0);
        window.lastReviewMeetingDate = $('#lastReviewMeetingDate').get(0);
        window.reviewDate = $('#reviewDate').get(0);

        var assignClass = function () {
            var elem = $(this);
            var tr = elem.closest('tr');


            if (elem[0].value === 'main') {
                // we want to show the
                tr.find('.onlyMain').show();
                tr.addClass('redText');
            } else {
                tr.find('.onlyMain').hide();
                tr.removeClass('redText');
            }
        };

        $('body').on('change', '[data-type="mainSelector"]', assignClass);

        $('[data-type="mainSelector"]').each(assignClass);

        var types = {};

        $('[data-validation="atLeastOne"], [data-validation="atLeastOneAtMostOne"]').each(function (index) {
            var $this = $(this);

            if (typeof types[$this.data().type] === 'undefined') {
                $this.validate();
                types[$this.data().type] = true;
            }
        });


    });
    window.onbeforeunload = bunload;

    function bunload() {
        if (customerNotesChanged) {
            return 'You haven\'t saved your notes';
        }
    }

    function setCaretPosition(elemId, caretPos) {
        var elem = document.getElementById(elemId);

        if (elem != null) {
            if (elem.createTextRange) {
                var range = elem.createTextRange();
                range.move('character', caretPos);
                range.select();
            }
            else {
                if (elem.selectionStart) {
                    elem.focus();
                    elem.setSelectionRange(caretPos, caretPos);
                }
                else
                    elem.focus();
            }
        }
    }

    var customerNotesChanged = false;

    function setCustomerNotesChanged() {

        customerNotesChanged = true;

    }

    function MM_jumpMenu(targ, selObj, restore) { //v3.0
        window.open(selObj.options[selObj.selectedIndex].value, targ);
        if (restore) selObj.selectedIndex = 0;
    }

    function loadNote(noteIdentifier) {

        var customerID = document.getElementById('customerID').value;

        if (customerID == 0) {
            return;
        }

        if (customerNotesChanged) {
            if (!confirm('You haven\'t saved your notes. Are you sure you want to move away?')) {
                return
            }
        }

        customerNotesChanged = false;

        var created = document.getElementById('customerNoteCreated').value;
        var url = "CustomerNote.php?action=getCustomerNote&customerID=" + customerID + "&created=" + created + "&identifier=" + noteIdentifier;

        loadXMLDoc(url);

    }

    function newNote() {

        var customerNoteID = document.getElementById('customerNoteID');
        var customerNoteOrdheadID = document.getElementById('customerNoteOrdheadID');
        var customerNoteDetails = document.getElementById('customerNoteDetails');
        var customerNoteModifiedText = document.getElementById('customerNoteModifiedText');

        customerNoteID.value = '';
        customerNoteOrdheadID.value = '';
        customerNoteDetails.value = '';
        customerNoteModifiedText.innerHTML = '';

    }

    function deleteNote() {
        var customerID = document.getElementById('customerID').value;
        var customerNoteID = document.getElementById('customerNoteID');

        if (customerNoteID.value == '') {
            return;
        }

        if (!confirm('Are you sure you want to delete this note?')) {
            return;
        }

        customerNotesChanged = false;

        var customerNoteDetails = document.getElementById('customerNoteDetails');
        var customerNoteModifiedText = document.getElementById('customerNoteModifiedText');

        var url = "CustomerNote.php?action=deleteCustomerNote&customerNoteID=" + customerNoteID.value;

        loadXMLDoc(url);

        customerNoteID.value = '';
        customerNoteDetails.value = '';
        customerNoteModifiedText.innerHTML = 'Note Deleted';

    }

    function saveNote() {

        var customerID = document.getElementById('customerID').value;

        if (customerID == 0) {
            return;
        }

        var customerNoteID = document.getElementById('customerNoteID').value;
        var customerNoteOrdheadID = document.getElementById('customerNoteOrdheadID').value;
        var details = encodeURIComponent(document.getElementById('customerNoteDetails').value);

        var url = "CustomerNote.php?action=updateNote&customerNoteID=" +
            customerNoteID + "&ordheadID=" + customerNoteOrdheadID + "&customerID=" + customerID + "&details=" + details;

        customerNotesChanged = false;

        loadXMLDoc(url);

    }

    function contactPopup(contactID, action, customerID, siteNo) {
        window.open(
            '{urlContactPopup}' +
            '&action=' + action +
            '&contactID=' + contactID +
            '&customerID=' + customerID +
            '&siteNo=' + siteNo +
            '&parentIDField=none' +
            '&parentDescField=none',
            'contact',
            'scrollbars=yes,resizable=yes,height=700,width=500,copyhistory=no, menubar=0'
        );
    }


    function checkMailShotOptions() {

        var x = document.getElementsByClassName('stmCheckBox');
        var count = 0;
        var i = 0;
        do {
            if (x[i].checked) {
                count++;
            }

            i++;
        } while (count < 2 && i < x.length);

        if (count > 1) {
            alert('There cannot be more than one "stm" option selected');
            return false;
        }

        if (!count) {
            alert('There needs to be at least one "stm" option selected');
            return false;
        }

        x = document.getElementsByClassName('invCheckBox');
        count = 0;
        i = 0;
        do {
            if (x[i].checked) {
                count++;
            }

            i++;
        } while (count < 1 && i < x.length);

        if (!count) {
            alert('There needs to be at least one "inv" option selected');
            return false;
        }

        return true;
    }

    $(function () {
        loadNote('first');
    })
    //-->
</script>
<link rel="stylesheet"
      href="/font-awesome/css/font-awesome.css"
/>
<script language='JavaScript'
        src='popcalendar/popcalendar.js'
></script>
<span class="formError">{errorMessage}</span>
<a href="{deleteCustomerURL}"
   onClick="if(!confirm('Are you sure you want to delete this customer?')) return(false)"
>{deleteCustomerText}</a>
<form name="form"
      method="post"
      action="{submitURL}"
      AUTOCOMPLETE="off"
      onsubmit="return checkMailShotOptions();"
>
    <input type="hidden"
           id="customerID"
           name="form[customer][{customerID}][customerID]"
           value="{customerID}"
    >
    <input type="hidden"
           name="form[customer][{customerID}][createDate]"
           value="{createDate}"
    >
    <input type="hidden"
           name="form[customer][{customerID}][regNo]"
           value="{regNo}"
           size="10"
           maxlength="10"
    >
    <input
            name="form[customer][{customerID}][gscTopUpAmount]"
            type="hidden"
            value="{gscTopUpAmount}"
    >
    <input
            name="customerNoteID"
            id="customerNoteID"
            type="hidden"
            value="{customerNoteID}"
    >
    <input
            name="customerNoteOrdheadID"
            id="customerNoteOrdheadID"
            type="hidden"
            value="{customerNoteOrdheadID}"
    >
    <input
            name="customerNoteCreated"
            id="customerNoteCreated"
            type="hidden"
            value="{customerNoteCreated}"
    >
    <input
            name="customerNoteModified"
            id="customerNoteModified"
            type="hidden"
            value="{customerNoteModified}"
    >
    <input
            name="form[customer][{customerID}][reviewMeetingEmailSentFlag]"
            id="reviewMeetingEmailSentFlag"
            type="hidden"
            value="{reviewMeetingEmailSentFlag}"
    >

    <input {disabled}
           type="submit"
           name="Go"
           value="Save"
    >
    <input {disabled}
           name="Button"
           type="button"
           value="Cancel"
           onClick="document.location='{cancelURL}';"
    >
    <input {disabled}
           name="displayInactiveSites"
           type="button"
           value="Show Inactive Sites"
           onClick="document.location='{showInactiveSitesURL}';"

    ><input {disabled}
            name="displayInactiveContacts"
            type="button"
            value="Show Inactive Contacts"
            onClick="document.location='{showInactiveContactsURL}';"

>
    <BR>
    {customerFolderLink}
    <br>
    {renewalLink}
    <BR>
    {passwordLink}
    <BR>
    {customerFolderLink}
    <br>
    {thirdPartyContactsLink}
    <br>

    <div class="customerEditMain">

        <div class="customerEditMainLeftColumn">

            <table class="content"
                   border="0"
                   cellpadding="2"
                   cellspacing="1"
                   width="100%"
            >
                <tr valign="top">
                    <td class="content"
                        width="13%"
                    >Customer {customerID}
                    </td>
                    <td class="content">
                        <input
                                {disabled}
                                name="form[customer][{customerID}][name]"
                                type="text"
                                value="{customerName}"
                                size="50"
                                maxlength="50"
                        >
                    </td>

                </tr>
                <tr>
                    <td class="content">Mailshot</td>
                    <td class="content">
                        <input {disabled}
                               type="checkbox"
                               name="form[customer][{customerID}][mailshotFlag]"
                               value="Y"
                               {mailshotFlagChecked}
                        ></td>
                </tr>
                <tr>
                    <td class="content">Referred</td>
                    <td class="content">
                        <input {disabled}
                               type="checkbox"
                               name="form[customer][{customerID}][referredFlag]"
                               value="Y"
                               id="referred"
                               {referredFlagChecked}
                        /></td>
                </tr>
                <tr>
                    <td class="content">Special Attention</td>
                    <td class="content">
                        <input {disabled}
                               type="checkbox"
                               name="form[customer][{customerID}][specialAttentionFlag]"
                               value="Y"
                               {specialAttentionFlagChecked}
                        />
                        until
                        <input
                                {disabled}
                                type="text"
                                name="form[customer][{customerID}][specialAttentionEndDate]"
                                id="specialAttentionEndDate"
                                value="{specialAttentionEndDate}"
                                size="10"
                                maxlength="10"
                                autocomplete="off"
                                class="jQueryCalendar"
                        >
                        <span class="formErrorMessage">{specialAttentionEndDateMessage}</span>
                    </td>
                </tr>
                <tr>
                    <td class="content">Last Review Meeting</td>
                    <td class="content">
                        <input
                                {disabled}
                                type="text"
                                name="form[customer][{customerID}][lastReviewMeetingDate]"
                                id="lastReviewMeetingDate"
                                value="{lastReviewMeetingDate}"
                                size="10"
                                maxlength="10"
                                autocomplete="off"
                                class="jQueryCalendar"
                        >
                        Frequency
                        <select {disabled}
                                name="form[customer][{customerID}][reviewMeetingFrequencyMonths]"
                        >
                            <!-- BEGIN reviewFrequencyBlock -->
                            <option {reviewMeetingFrequencyMonthsSelected}
                                    value="{reviewMeetingFrequencyMonths}"
                            >
                                {reviewMeetingFrequencyMonthsDescription}
                            </option>
                            <!-- END reviewFrequencyBlock -->
                        </select>
                        <span class="formErrorMessage">{reviewMeetingFrequencyMonthsMessage}</span>
                    </td>
                </tr>
                <tr>
                    <td class="content">Prospect</td>
                    <td class="content">
                        <input {disabled}
                               type="checkbox"
                               name="form[customer][{customerID}][prospectFlag]"
                               value="Y"
                               {prospectFlagChecked}
                        >
                        <select {disabled}
                                name="form[customer][{customerID}][leadStatusID]"
                        >
                            <option value="">None</option>
                            <!-- BEGIN leadStatusBlock -->
                            <option {leadStatusSelected}
                                    value="{leadStatusID}"
                            >{leadStatusDescription}
                            </option>
                            <!-- END leadStatusBlock -->
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="content">24 Hour Cover</td>
                    <td class="content">
                        <input {disabled}
                               type="checkbox"
                               name="form[customer][{customerID}][support24HourFlag]"
                               value="Y"
                               {support24HourFlagChecked}
                        ></td>
                </tr>
                <tr>
                    <td class="content">Type</td>
                    <td class="content">
                        <select {disabled}
                                name="form[customer][{customerID}][customerTypeID]"
                        >
                            <!-- BEGIN customerTypeBlock -->
                            <option {customerTypeSelected}
                                    value="{customerTypeID}"
                            >{customerTypeDescription}
                            </option>
                            <!-- END customerTypeBlock -->
                        </select></td>
                </tr>
                <tr>
                    <td class="content">Sector</td>
                    <td class="content">
                        <select {disabled}
                                name="form[customer][{customerID}][sectorID]"
                        >
                            <option value="">Please select</option>
                            <!-- BEGIN sectorBlock -->
                            <option {sectorSelected}
                                    value="{sectorID}"
                            >{sectorDescription}
                            </option>
                            <!-- END sectorBlock -->
                        </select><span class="formErrorMessage">{SectorMessage}</span></td>
                </tr>
                <tr>
                    <td class="content">PCs</td>
                    <td class="content">
                        <select
                                {disabled}
                                name="form[customer][{customerID}][noOfPCs]"
                        >
                            <!-- BEGIN noOfPCsBlock -->
                            <option {noOfPCsSelected}
                                    value="{noOfPCsValue}"
                            >{noOfPCsValue}
                            </option>
                            <!-- END noOfPCsBlock -->
                        </select></td>
                </tr>
                <tr>
                    <td class="content">Servers</td>
                    <td class="content">
                        <input
                                name="form[customer][{customerID}][noOfServers]"
                                type="text"
                                value="{noOfServers}"
                                size="10"
                                maxlength="10"
                                {disabled}
                        ></td>
                </tr>
                <tr>
                    <td class="content">Reg</td>
                    <td class="content"><input
                            name="form[customer][{customerID}][regNo]"
                            type="text"
                            value="{regNo}"
                            size="10"
                            maxlength="10"
                            {disabled}
                    ></td>
                </tr>
                <tr>
                    <td class="content">Sites</td>
                    <td class="content"><input
                            {disabled}
                            name="form[customer][{customerID}][noOfSites]"
                            type="text"
                            value="{noOfSites}"
                            size="2"
                            maxlength="2"
                    ></td>
                </tr>
                <tr>
                    <td class='content'>Pre-pay Top Up</td>
                    <td class='content'><input
                            name="form[customer][{customerID}][gscTopUpAmount]"
                            type="text"
                            value="{gscTopUpAmount}"
                            size="10"
                            maxlength="10"
                            {disabled}
                    >
                    </td>
                </tr>
                <tr>
                    <td class='content'>Became Customer</td>
                    <td class='content'><input
                            name="form[customer][{customerID}][becameCustomerDate]"
                            type="text"
                            value="{becameCustomerDate}"
                            size="10"
                            maxlength="10"
                            {disabled}
                    >
                    </td>
                </tr>
                <tr>
                    <td class='content'>Dropped Date</td>
                    <td class='content'><input
                            name="form[customer][{customerID}][droppedCustomerDate]"
                            type="text"
                            value="{droppedCustomerDate}"
                            size="10"
                            maxlength="10"
                            {disabled}
                    >
                    </td>
                </tr>
                <tr>
                    <td class="content">SLA Response Hours</td>
                    <td class="content">
                        1<input
                            name="form[customer][{customerID}][slaP1]"
                            type="text"
                            value="{slaP1}"
                            size="1"
                            maxlength="3"
                            {disabled}
                    >
                        2<input
                            name="form[customer][{customerID}][slaP2]"
                            type="text"
                            value="{slaP2}"
                            size="1"
                            maxlength="3"
                            {disabled}
                    >
                        3<input
                            name="form[customer][{customerID}][slaP3]"
                            type="text"
                            value="{slaP3}"
                            size="1"
                            maxlength="3"
                            {disabled}
                    >
                        4<input
                            name="form[customer][{customerID}][slaP4]"
                            type="text"
                            value="{slaP4}"
                            size="1"
                            maxlength="3"
                            {disabled}
                    >
                        5<input
                            name="form[customer][{customerID}][slaP5]"
                            type="text"
                            value="{slaP5}"
                            size="1"
                            maxlength="3"
                            {disabled}
                    >
                    </td>
                </tr>
                <tr>
                    <td class="content">Last Modified</td>
                    <td class="content">{modifyDate}</td>
                </tr>
                <tr>
                    <td colspan="2"
                        class="content"
                    >

                    </td>
                </tr>
                <tr>
                    <td class="content">Technical Notes</td>
                    <td class="content">
                        <input
                                {disabled}
                                type="text"
                                name="form[customer][{customerID}][techNotes]"
                                id="techNotes"
                                value="{techNotes}"
                                size="54"
                                maxlength="100"
                        >
                    </td>
                </tr>

                <tr>
                    <td class="content">Account Manager</td>
                    <td class="content">
                        <select
                                {disabled}
                                type="text"
                                name="form[customer][{customerID}][accountManagerUserID]"
                                onchange="setFormChanged();"
                        >
                            <!-- BEGIN accountManagerBlock -->
                            <option {accountManagerUserSelected}
                                    value="{accountManagerUserID}"
                            >
                                {accountManagerUserName}
                            </option>
                            <!-- END accountManagerBlock -->
                        </select>
                    </td>
                </tr>
            </table>

        </div> <!-- customerEditMainLeftColumn -->

        <div class="customerEditMainRightColumn">

            <div class="customerReviewTime">
                To be reviewed on
                <input
                        {disabled}
                        type="text"
                        name="form[customer][{customerID}][reviewDate]"
                        id="reviewDate"
                        value="{reviewDate}"
                        size="10"
                        maxlength="10"
                        autocomplete="off"
                        class="jQueryCalendar"
                >
                Time
                <input
                        {disabled}
                        name="form[customer][{customerID}][reviewTime]"
                        value="{reviewTime}"
                        size="5"
                        maxlength="5"
                >
                <span class="formErrorMessage formError">{reviewTimeMessage}</span>By
                <select
                        {disabled}
                        type="text"
                        name="form[customer][{customerID}][reviewUserID]"
                        onchange="setFormChanged();"
                >
                    <!-- BEGIN reviewUserBlock -->
                    <option {reviewUserSelected}
                            value="{reviewUserID}"
                    >{reviewUserName}
                    </option>
                    <!-- END reviewUserBlock -->
                </select>
            </div> <!-- customerReviewTime -->

            <div class="customerReviewAction">
                <textarea title="Action to be taken"
                          {disabled}
                          cols="120"
                          rows="3"
                          name="form[customer][{customerID}][reviewAction]"
                >{reviewAction}</textarea>
            </div>

            <div class="customerNoteHistory">
        <textarea
                cols="120"
                rows="18"
                readonly="readonly"
                {disabled}
                id="customerNoteHistory"
        ></textarea>
            </div>

            <div class="customerNoteNav">
                <button {disabled}
                        type="button"
                        name="First"
                        aria-hidden="true"
                        onclick="loadNote('first')"
                >
                    <i class="fa fa-step-backward"></i> First
                </button>
                <button {disabled}
                        type="button"
                        name="Previous"
                        onclick="loadNote('previous')"
                >
                    <i class="fa fa-backward"
                       aria-hidden="true"
                    ></i> Back
                </button>
                <button {disabled}
                        type="button"
                        name="Next"
                        onclick="loadNote('next')"
                >
                    Next <i class="fa fa-forward"
                            aria-hidden="true"
                ></i>
                </button>
                <button {disabled}
                        type="button"
                        name="Last"
                        onclick="loadNote('last')"
                >
                    Last <i class="fa fa-step-forward"
                            aria-hidden="true"
                ></i>
                </button>
                <button {disabled}
                        type="button"
                        name="Delete"
                        onclick="deleteNote()"
                >
                    <i class="fa fa-trash"
                       aria-hidden="true"
                    ></i>
                    Delete
                </button>
                <button {disabled}
                        type="button"
                        name="New"
                        onclick="newNote()"
                >
                    <i class="fa fa-plus-circle"
                       aria-hidden="true"
                    ></i>
                    New
                </button>
                <button {disabled}
                        type="button"
                        name="Save"
                        onclick="saveNote()"
                >
                    <i class="fa fa-floppy-o"
                       aria-hidden="true"
                    ></i>
                    Save
                </button>
                {customerNotePopupLink}
            </div>

            <div id="customerNoteModifiedText"></div>

            <div class="customerNoteDetails">
        <textarea
                {disabled}
                name="customerNoteDetails"
                id="customerNoteDetails"
                cols="120"
                onchange="setCustomerNotesChanged()"
                rows="12"
        >{customerNoteDetails}
        </textarea>
            </div>
            <div>
                {lastContractSent}
            </div>
        </div> <!-- customerEditMainRightColumn -->

    </div> <!-- customerEditMain -->

    <div class="customerEditProjects">
        <h3>Projects</h3>
        <a href="{addProjectURL}">{addProjectText}</a>
        <table class="content"
               border="0"
               cellpadding="2"
               cellspacing="1"
        >
            <tr>
                <td nowrap="nowrap"
                    class="headerLightgrey"
                >Name
                </td>
                <td nowrap="nowrap"
                    class="headerLightgrey"
                >Notes
                </td>
                <td class="headerLightgrey">Starts</td>
                <td class="headerLightgrey">Expires</td>
                <td class="headerLightgrey">&nbsp;</td>
            </tr>
            <!-- BEGIN projectBlock -->
            <tr>
                <td class="content">{projectName}</td>
                <td class="contentWrap">{notes}</td>
                <td class="content">{startDate}</td>
                <td class="content">{expiryDate}</td>
                <td width="68%"
                    class="content"
                ><A href="{editProjectLink}">edit</A> <A href="{deleteProjectLink}">{deleteProjectText}</A>
                </td>
            </tr>
            <!-- END projectBlock -->
        </table>
    </div> <!-- customerEditProjects -->

    <div class="customerEditPortalCustomerDocuments">
        <h3>Portal Documents</h3>
        <a href="{urlAddDocument}">{txtAddDocument}</a>
        <table class="singleBorder"
               width="50%"
        >
            <tr>
                <td class="listHeadText">Description</td>
                <td class="listHeadText">File</td>
                <td class="listHeadText">Starters Form</td>
                <td class="listHeadText">Leavers Form</td>
                <td class="listHeadText">Main Contact Only</td>
                <td class="listHeadText"
                    colspan="2"
                >&nbsp;
                </td>
            </tr>
            <!-- BEGIN portalDocumentBlock -->
            <tr valign="top"
                onMouseOver="this.bgColor='#ffffcc';"
                onMouseOut="this.bgColor='';"
            >
                <td class="content"
                    nowrap="nowrap"
                ><A href="{urlViewFile}"
                    title="View attached document"
                >{description}</A></td>
                <td class="content"
                    nowrap="nowrap"
                ><A href="{urlViewFile}"
                    title="View attached document"
                >{filename}</A></td>
                <td class="content"
                    nowrap="nowrap"
                >{startersFormFlag}
                </td>
                <td class="content"
                    nowrap="nowrap"
                >{leaversFormFlag}
                </td>
                <td class="content"
                    nowrap="nowrap"
                >{mainContactOnlyFlag}
                </td>
                <td class="content"><A href="{urlEditDocument}">edit</A></td>
                <td class="content">
                    <A href="{urlDeleteDocument}"
                       title="Delete attached document"
                       onClick="if(!confirm('Are you sure you want to remove this document?')) return(false)"
                    >delete</A>
                </td>
            </tr>
            <!-- END portalDocumentBlock -->
        </table>
        <h3>Sites</h3>
        <div class="customerEditSites">
            <div class="addSite">
                <a href="{addSiteURL}">{addSiteText}</a>
            </div>
            <!-- BEGIN siteBlock -->
            <DIV class="site">
                <input
                        type="hidden"
                        name="form[site][{customerID}{siteNo}][sageRef]"
                        value="{sageRef}"
                        size="3"
                        maxlength="6"
                >
                <input type="hidden"
                       name="form[site][{customerID}{siteNo}][siteNo]"
                       value="{siteNo}"
                >
                <input type="hidden"
                       name="form[site][{customerID}{siteNo}][customerID]"
                       value="{customerID}"
                >
                <input type="hidden"
                       name="form[site][{customerID}{siteNo}][debtorCode]"
                       value="{debtorCode}"
                >
                <table class="content"
                       border="0"
                       cellpadding="2"
                       cellspacing="1"
                       width="10%"
                >
                    <tr>
                        <td class="headerDarkgrey"
                            colspan="2"
                        >Site {siteNo}<a href="{deleteSiteURL}"
                                         onClick="if(!confirm('Are you sure you want to delete this site?')) return(false)"
                        >{deleteSiteText}</a>
                        </td>
                    </tr>
                    <tr>
                        <td class="content"
                            width="13%"
                        >Site Address
                        </td>
                        <td class="content"
                            width="87%"
                        >
                            <input
                                    {disabled}
                                    name="form[site][{customerID}{siteNo}][add1]"
                                    value="{add1}"
                                    size="35"
                                    maxlength="35"
                            ></td>
                    </tr>
                    <tr>
                        <td class="content">&nbsp;</td>
                        <td class="content">
                            <input
                                    {disabled}
                                    name="form[site][{customerID}{siteNo}][add2]"
                                    value="{add2}"
                                    size="35"
                                    maxlength="35"
                            ></td>
                    </tr>
                    <tr>
                        <td class="content">&nbsp;</td>
                        <td class="content"><input
                                {disabled}
                                name="form[site][{customerID}{siteNo}][add3]"
                                value="{add3}"
                                size="35"
                                maxlength="35"
                        /></td>
                    </tr>
                    <tr>
                        <td class="content">Town</td>
                        <td class="content">
                            <input
                                    {disabled}
                                    name="form[site][{customerID}{siteNo}][town]"
                                    value="{town}"
                                    size="25"
                                    maxlength="25"
                            ></td>
                    </tr>
                    <tr>
                        <td class="content">County</td>
                        <td class="content">
                            <input
                                    {disabled}
                                    name="form[site][{customerID}{siteNo}][county]"
                                    value="{county}"
                                    size="25"
                                    maxlength="25"
                            ></td>
                    </tr>
                    <tr>
                        <td class="content">Postcode</td>
                        <td class="content">
                            <input
                                    {disabled}
                                    name="form[site][{customerID}{siteNo}][postcode]"
                                    value="{postcode}"
                                    size="15"
                                    maxlength="15"
                            ></td>
                    </tr>
                    <tr>
                        <td class="content">Phone</td>
                        <td class="content">
                            <input
                                    {disabled}
                                    name="form[site][{customerID}{siteNo}][phone]"
                                    value="{sitePhone}"
                                    size="20"
                                    maxlength="20"
                            ></td>
                    </tr>
                    <tr>
                        <td class="content">Max Travel Hours</td>
                        <td class="content"><input
                                name="form[site][{customerID}{siteNo}][maxTravelHours]"
                                id="form[site][{customerID}{siteNo}][maxTravelHours]"
                                value="{maxTravelHours}"
                                size="5"
                                maxlength="5"
                                {disabled}
                        /></td>
                    </tr>
                    <tr>
                        <td class="content">Default Invoice</td>
                        <td class="content">
                            <input {disabled}
                                   type="radio"
                                   name="form[customer][{customerID}][invoiceSiteNo]"
                                   value="{siteNo}"
                                   {invoiceSiteFlagChecked}
                            /></td>
                    </tr>
                    <tr>
                        <td class="content">Default Delivery</td>
                        <td class="content">
                            <input {disabled}
                                   type="radio"
                                   name="form[customer][{customerID}][deliverSiteNo]"
                                   value="{siteNo}"
                                   {deliverSiteFlagChecked}
                            /></td>
                    </tr>
                    <tr>
                        <td class="content">Invoice Contact</td>
                        <td>
                            <select
                                    name="form[site][{customerID}{siteNo}][invoiceContactID]"
                            >
                                <!-- BEGIN selectInvoiceContactBlock -->
                                <option {selectInvoiceContactBlockSelected}
                                        value="{selectInvoiceContactBlockContactID}"
                                >
                                    {selectInvoiceContactBlockFirstName} {selectInvoiceContactBlockLastName}
                                </option>
                                <!-- END selectInvoiceContactBlock -->
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="content">Delivery Contact</td>
                        <td>
                            <select
                                    name="form[site][{customerID}{siteNo}][deliverContactID]"
                            >
                                <!-- BEGIN selectDeliverContactBlock -->
                                <option {selectDeliverContactBlockSelected}
                                        value="{selectDeliverContactBlockContactID}"
                                >
                                    {selectDeliverContactBlockFirstName} {selectDeliverContactBlockLastName}
                                </option>
                                <!-- END selectDeliverContactBlock -->
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="content">Non UK</td>
                        <td class="content">
                            <input {disabled}
                                   type="checkbox"
                                   name="form[site][{customerID}{siteNo}][nonUKFlag]"
                                   title="Check to show this site is overseas and not in the UK"
                                   value="Y"
                                   {nonUKFlagChecked}
                            />
                        </td>
                    </tr>
                    <tr>
                        <td class="content">Active</td>
                        <td class="content">
                            <input {disabled}
                                   type="checkbox"
                                   name="form[site][{customerID}{siteNo}][activeFlag]"
                                   value="Y"
                                   {activeFlagChecked}
                            />
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2"
                            class="content"
                        >
                            <a href="#"
                               onclick="contactPopup(0, 'addContact', {customerID}, {siteNo} )"
                            >{addContactText}</a>
                        </td>
                    </tr>

                </table>
            </div> <!-- site -->

            <!-- END siteBlock -->
        </div> <!-- customerEditSites -->
        <br/>
        <br/>
        <h3 style="clear: both;">Contacts</h3>
        <div class="contacts"
             id="contactsTable"
        >
            <table class="content"
                   border="0"
                   cellpadding="2"
                   cellspacing="1"
                   width="100%"
            >
                <thead>
                <tr>
                    <td class="headerLightgrey">&nbsp;</td>
                    <td class="headerLightgrey">&nbsp;</td>
                    <td class="headerLightgrey">Site</td>
                    <td class="headerLightgrey">Title</td>
                    <td class="headerLightgrey">First</td>
                    <td class="headerLightgrey">Last</td>
                    <td class="headerLightgrey">Position</td>
                    <td class="headerLightgrey">Phone</td>
                    <td class="headerLightgrey">Mobile</td>
                    <td class="headerLightgrey">Email</td>
                    <td class="headerLightgrey">Password</td>
                    <td class="headerLightgrey">Failed Logins</td>
                    <td class="headerLightgrey">Notes</td>
                    <td class="headerLightgrey">Initial Logging?</td>
                    <td class="headerLightgrey">Work Started?</td>
                    <td class="headerLightgrey">Work Updates?</td>
                    <td class="headerLightgrey">Fixed?</td>
                    <td class="headerLightgrey">Pending Closure?</td>
                    <td class="headerLightgrey">Closure?</td>
                    <td class="headerLightgrey">Others Initial Logging?</td>
                    <td class="headerLightgrey">Others Work Started?</td>
                    <td class="headerLightgrey">Others Work Updates?</td>
                    <td class="headerLightgrey">Others Fixed?</td>
                    <td class="headerLightgrey">Others Pending Closure?</td>
                    <td class="headerLightgrey">Others Closure?</td>
                    <td class="headerLightgrey">Accounts</td>
                    <td class="headerLightgrey">{mailshot2FlagDesc}</td>
                    <td class="headerLightgrey">{mailshot3FlagDesc}</td>
                    <td class="headerLightgrey">{mailshot4FlagDesc}</td>
                    <td class="headerLightgrey">Support Level</td>
                    <td class="headerLightgrey">HR</td>
                    <td class="headerLightgrey">Review</td>
                    <td class="headerLightgrey">{mailshot8FlagDesc}</td>
                    <td class="headerLightgrey">{mailshot11FlagDesc}</td>
                    <td class="headerLightgrey">{mailshot9FlagDesc}</td>
                    <td class="headerLightgrey">Mailshot</td>
                    <td class="headerLightgrey">Letters</td>
                    <td class="headerLightgrey">Pending Leaver</td>
                    <td class="headerLightgrey">Pending Leaver Date</td>

                </tr>
                </thead>
                <tbody>
                <!-- BEGIN contactBlock -->
                <input type="hidden"
                       name="form[contact][{contactID}][contactID]"
                       value="{contactID}"
                >
                <input type="hidden"
                       name="form[contact][{contactID}][customerID]"
                       value="{customerID}"
                >
                <input type="hidden"
                       name="form[contact][{contactID}][supplierID]"
                       value="{supplierID}"
                >
                <input type="hidden"
                       name="form[contact][{contactID}][fax]"
                       value="{fax}"
                >
                <input type="hidden"
                       name="form[contact][{contactID}][discontinuedFlag]"
                       value="{discontinuedFlag}"
                >
                <input
                        type="hidden"
                        name="form[contact][{contactID}][mobilePhone]"
                        value="{mobilePhone}"
                >

                <tr>
                    <td>
                        <A href="#"
                           onclick="javascript:contactPopup({contactID}, 'editContact', '{customerID}','{siteNo}' )"
                        >edit</a>
                    </td>
                    <td>{deleteContactLink}</td>
                    <td>
                        <select
                                name="form[contact][{contactID}][siteNo]"
                                data-validation="required"
                        >
                            <!-- BEGIN selectSiteBlock -->
                            <option {siteSelected}
                                    value="{selectSiteNo}"
                            >{selectSiteDesc}
                            </option>
                            <!-- END selectSiteBlock -->
                        </select>
                    </td>
                    <td class="{titleClass}">
                        <input
                                {disabled}
                                name="form[contact][{contactID}][title]"
                                size="2"
                                maxlength="10"
                                value="{title}"
                                required
                                data-validation="required"
                        >
                    </td>
                    <td class='{firstNameClass}'>
                        <input
                                {disabled}
                                name="form[contact][{contactID}][firstName]"
                                size="10"
                                maxlength="50"
                                value="{firstName}"
                                required
                                data-validation="required"
                        >
                    </td>
                    <td class='{lastNameClass}'>
                        <input
                                {disabled}
                                name="form[contact][{contactID}][lastName]"
                                size="10"
                                maxlength="50"
                                value="{lastName}"
                                required
                                data-validation="required"
                        >
                    </td>
                    <td>
                        <input
                                name="form[contact][{contactID}][position]"
                                id="form[contact][{contactID}][position]"
                                value="{position}"
                                size="10"
                                maxlength="20"
                                {disabled}
                        />
                    </td>
                    <td>
                        <input
                                {disabled}
                                name="form[contact][{contactID}][phone]"
                                value="{phone}"
                                size="10"
                                maxlength="30"
                        >
                    </td>
                    <td>
                        <input
                                {disabled}
                                name="form[contact][{contactID}][mobilePhone]"
                                value="{mobilePhone}"
                                size="10"
                                maxlength="30"
                        >
                    </td>
                    <td class='{emailClass}'>
                        <input
                                {disabled}
                                type="email"
                                name="form[contact][{contactID}][email]"
                                value="{email}"
                                size="25"
                                maxlength="50"
                                data-validation="emailOrEmpty server"
                                data-validation-url="/validateUniqueEmail.php"
                        >
                    </td>
                    <td class="center">
                        <button onclick="askNewPassword()"
                                data-contact-id="{contactID}"
                                type="button"
                                class="{portalPasswordButtonClass}"
                        >
                        </button>
                    </td>
                    <td>
                        <input
                                {disabled}
                                name="form[contact][{contactID}][failedLoginCount]"
                                value="{failedLoginCount}"
                                size="2"
                                maxlength="5"
                        >
                    </td>
                    <td>
                        <input
                                {disabled}
                                name="form[contact][{contactID}][notes]"
                                size="5"
                                maxlength="200"
                                value="{notes}"
                        />
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][initialLoggingEmailFlag]"
                               value="Y"
                               {initialLoggingEmailFlagChecked}
                               class="checkboxAlign"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][workStartedEmailFlag]"
                               value="Y"
                               {workStartedEmailFlagChecked}
                               class="checkboxAlign"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][workUpdatesEmailFlag]"
                               value="Y"
                               {workUpdatesEmailFlagChecked}
                               class="checkboxAlign"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][fixedEmailFlag]"
                               value="Y"
                               {fixedEmailFlagChecked}
                               class="checkboxAlign"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][pendingClosureEmailFlag]"
                               value="Y"
                               {pendingClosureEmailFlagChecked}
                               class="checkboxAlign"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][closureEmailFlag]"
                               value="Y"
                               {closureEmailFlagChecked}
                               class="checkboxAlign"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][othersInitialLoggingEmailFlag]"
                               value="Y"
                               {othersInitialLoggingEmailFlagChecked}
                               hidden
                               class="onlyMain"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][othersWorkStartedEmailFlag]"
                               value="Y"
                               {othersWorkStartedEmailFlagChecked}
                               hidden
                               class="onlyMain"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][othersWorkUpdatesEmailFlag]"
                               value="Y"
                               {othersWorkUpdatesEmailFlagChecked}
                               hidden
                               class="onlyMain"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][othersFixedEmailFlag]"
                               value="Y"
                               {othersFixedEmailFlagChecked}
                               hidden
                               class="onlyMain"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][othersPendingClosureEmailFlag]"
                               value="Y"
                               {othersPendingClosureEmailFlagChecked}
                               hidden
                               class="onlyMain"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][othersClosureEmailFlag]"
                               value="Y"
                               {othersClosureEmailFlagChecked}
                               hidden
                               class="onlyMain"
                        >
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][accountsFlag]"
                               value="Y"
                               {accountsFlagChecked}
                               data-validation="atLeastOne"
                               data-type="accounts"
                               data-except="$('#referred').prop('checked')"
                        />
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][mailshot2Flag]"
                               value="Y"
                               {mailshot2FlagChecked}
                               data-validation="atLeastOne"
                               data-type="invoice"
                               data-except="$('#referred').prop('checked')"
                        />
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][mailshot3Flag]"
                               value="Y"
                               {mailshot3FlagChecked}
                        />
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][mailshot4Flag]"
                               value="Y"
                               {mailshot4FlagChecked}
                               class="stmCheckBox"
                               data-validation="atLeastOneAtMostOne"
                               data-type="statement"
                               data-except="$('#referred').prop('checked')"
                        />
                    </td>
                    <td>
                        <select
                                name="form[contact][{contactID}][supportLevel]"
                                data-validation="atLeastOneMain"
                                data-type="mainSelector"
                                data-except="$('#referred').prop('checked')"
                        >
                            <!-- BEGIN supportLevelBlock -->
                            <option {supportLevelSelected}
                                    value="{supportLevelValue}"
                            >
                                {supportLevelDescription}
                            </option>
                            <!-- END supportLevelBlock -->
                        </select>
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][hrUser]"
                               value="Y"
                               {hrUserFlagChecked}
                        />
                    </td>

                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][reviewUser]"
                               value="Y"
                               {reviewUserFlagChecked}
                               data-validation="atLeastOne"
                               data-type="review"
                               data-except="$('#referred').prop('checked')"
                        />
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][mailshot8Flag]"
                               value="Y"
                               {mailshot8FlagChecked}
                               data-type="topUp"
                               {topUpValidation}
                               data-except="$('#referred').prop('checked')"
                        />
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][mailshot11Flag]"
                               value="Y"
                               {mailshot11FlagChecked}
                        />
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][mailshot9Flag]"
                               value="Y"
                               {mailshot9FlagChecked}
                               data-validation="atLeastOne"
                               data-type="reports"
                               data-except="$('#referred').prop('checked')"
                        />
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][sendMailshotFlag]"
                               value="Y"
                               {sendMailshotFlagChecked}
                        />
                    </td>
                    <td nowrap="nowrap">
                        <select {disabled}
                                name="letters_menu"
                                onchange="MM_jumpMenu('_blank',this,0)"
                        >
                            <option>Send Letter</option>
                            <option value="{clientFormURL}">Appointment</option>
                            <!-- BEGIN customLetterBlock -->
                            <option value="{customLetterURL}">{customLetterName}</option>
                            <!-- END customLetterBlock -->
                        </select>
                    </td>
                    <td>
                        <input {disabled}
                               type="checkbox"
                               name="form[contact][{contactID}][pendingLeaverFlag]"
                               value="Y"
                               {pendingLeaverFlagChecked}
                        />
                    </td>
                    <td>
                        <input {disabled}
                               type="text"
                               name="form[contact][{contactID}][pendingLeaverDate]"
                               value="{pendingLeaverDate}"
                               class="jQueryCalendar"
                               autocomplete="off"
                        />
                    </td>
                </tr>

                <!-- END contactBlock -->
                </tbody>
            </table>
        </div>
        <input {disabled}
               type="submit"
               name="Go"
               value="Save"
        >
        <input name="Button"
               type="button"
               value="Cancel"
               onClick="document.location='{cancelURL}';"
        >
    </div>
</form>

<div class="orders">
    <h3>Orders</h3>
    <table class="singleBorder"
           width="500px"
           border="0"
           cellspacing="1"
           cellpadding="1"
    >
        <tr>
            <td width="50px"
                class="listHeadText"
            >Order No
            </td>
            <td width="100px"
                class="listHeadText"
            >Type
            </td>
            <td width="50px"
                class="listHeadText"
            >Date
            </td>
            <td width="250px"
                class="listHeadText"
            >Cust PO Ref
            </td>
            <td width="50px"
                class="listHeadText"
            >Contract
            </td>
        </tr>
        <!-- BEGIN orderBlock -->
        <tr>
            <td class="listItemText"><a href="{orderURL}"
                                        target="_blank"
            >{ordheadID}</a></td>
            <td class="listItemText">{orderType}</td>
            <td class="listItemText">{orderDate}</td>
            <td class="listItemText">{custPORef}</td>
            <td class="listItemText"><a href="{listContractURL}">{contract}</a></td>
        </tr>
        <!-- END orderBlock -->
    </table>
</div>
