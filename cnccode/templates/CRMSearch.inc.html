<!-- Template: PasswordSearch.inc.html -->
<script language='JavaScript' src="CommonJS.js"></script>
<link rel="stylesheet" href="/font-awesome/css/font-awesome.css"/>
<script type="text/javascript">


    var savedCustomerString;

    function saveCustomerString() {
        savedCustomerString = document.getElementById("customerString").value
    }

    function validateCustomerString() {
        if (Trim(document.getElementById("customerString").value) != "") {
            if (document.getElementById("customerString").value != savedCustomerString) {
                window.open('{urlCustomerPopup}&customerString=' +
                    escape(document.getElementById("customerString").value) +
                    '&parentIDField=customerID' +
                    '&parentDescField=customerString',
                    'customers', 'scrollbars=yes,resizable=no,width=300,height=300,copyhistory=no, menubar=0')
            }
        }
        else {
            document.searchForm.customerID.value = "";
        }
    }
</script>
<style>
    input[type=text], select {
        padding: 5px;
        width: 230px;
        font-size: 14px
    }

    button {
        padding: 5px 9px;
        font-size: 14px;
    }

    hr {
        margin-top: 20px;
    }
</style>

<H2>{customerName}</H2>

<form name="search" id="search" method="post" action="{urlSubmit}">
    <input type="hidden" name="action" value="search">
    <table width="500px" border="0" cellspacing="0" cellpadding="1">
        <tr>
            <td width="130" class="promptText">
                <div align="right">Customer</div>
            </td>
            <td>
                <input
                        type="hidden"
                        name="searchForm[1][customerID]"
                        id="customerID"
                        value="{customerID}"
                        onchange="document.search.submit()"
                > <input
                    type="text" id="customerString" name="customerString"
                    value="{customerString}" onFocus="javascript:saveCustomerString()"
                    onBlur="javascript:validateCustomerString()" required
                    maxlength="50">
                <button>search <i class="fa fa-search" aria-hidden="true"></i></button>
            </td>
        </tr>
        <tr>
            <td><font class="formErrorMessage">
                {customerStringMessage} </font></td>
        </tr>
    </table>

</form>


<input type="hidden" name="action" value="search">
<table width="500px" border="0" cellspacing="0" cellpadding="1">
    <tr>
        <td width="130" class="promptText">
            <div align="right">Lead Status Search</div>
        </td>
        <td>
            <select id="customerLeadSelector">
                <option value="">-- Search All --</option>
                <!-- BEGIN customerLeadStatusBlock -->
                <option {customerLeadStatusSelected}
                        value="{customerLeadStatusID}">
                    {customerLeadStatusName}
                </option>
                <!-- END customerLeadStatusBlock -->
            </select>
            <button onclick="searchCustomers()">search <i class="fa fa-search" aria-hidden="true"></i></button>
        </td>
    </tr>
</table>
<hr/>

<link rel="stylesheet" type="text/css"
      href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-html5-1.5.1/datatables.min.css"/>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
<script type="text/javascript"
        src="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-html5-1.5.1/datatables.min.js"></script>
<script>

    var dataTableObject = {
        dom: 'Blfrtip',
        buttons: [
            {
                extend: 'csv',
                bom: true
            }
        ],
        columns: [
            {data: 'customerName'},
            {data: 'contactName'},
            {data: 'jobTitle'},
            {data: 'customerReviewDate'}
        ],
        columnDefs: [
            {
                render: function (data, type, row) {
                    return '<a href="' + row.customerLink + '">' + data + '</a>';
                },
                targets: 0
            }
        ],
        paging: false
    };

    var dataTable = null;

    function searchCustomers() {
        $.ajax({
            url: '{ajaxURL}',
            data: {customerLeadID: $('#customerLeadSelector').val()},
            method: 'POST'
        }).then(function (data) {
            if (!dataTable) {
                $('#tableWrapper').show();
                var theTable = $('#theTable');
                dataTableObject.data = data;
                dataTable = theTable.DataTable(dataTableObject);
            } else {
                dataTable.clear();
                dataTable.rows.add(data);
                dataTable.draw();
            }

        })
    }
</script>
<style>
    table.dataTable tfoot th {
        padding-right: 0px !important;
    }
</style>
<div style="display: none" id="tableWrapper">
    <table id="theTable">
        <thead>
        <tr>
            <th>
                Customer
            </th>
            <th>
                Contact Name
            </th>
            <th>
                Contact Job Title
            </th>
            <th>
                To be Reviewed On
            </th>
        </tr>
        </thead>
        <tbody id="dataBody">
        </tbody>
    </table>
</div>


<!-- End Template: PasswordSearch.inc.html -->