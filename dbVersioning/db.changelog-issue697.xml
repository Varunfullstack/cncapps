<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet author="pavwebdev" id="issue697-0">
        <tagDatabase tag="issue697"/>
    </changeSet>
    <changeSet author="pavwebdev" id="issue697-1">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                select "Implementations" = name from team where teamID = 4
            </sqlCheck>
        </preConditions>
        <sql>
            update team
            set name = 'Small Projects'
            where teamID = 4;
        </sql>
        <rollback>
            <sql>
                update team
                set name = 'Implementations'
                where teamID = 4;
            </sql>
        </rollback>
    </changeSet>
    <changeSet author="pavwebdev" id="issue697-2">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="team" columnName="leaderId"/>
            </not>
        </preConditions>
        <addColumn tableName="team">
            <column name="leaderId" type="int(11)">
                <constraints nullable="false" foreignKeyName="fk_consultant_id" referencedTableName="consultant"
                             referencedColumnNames="cns_consno"/>
            </column>
        </addColumn>
        <rollback>
            <dropColumn tableName="team" columnName="leaderId"/>
        </rollback>
        <sql>
            update team
            set leaderId = CASE teamID
                               WHEN 1 THEN 85
                               WHEN 2 THEN 99
                               WHEN 4 THEN 50
                               when 5 then 47
                               else 2
                END
        </sql>
        <rollback/>
    </changeSet>


</databaseChangeLog>